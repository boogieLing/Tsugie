# 项目变更记录

## 2026-02-14
- iOS 阶段文档基线补齐（AGENTS/README）：
  - 变更内容：更新 `AGENTS.md`，新增“iOS 开发阶段基线（强制）”并明确以 `需求/tsugie-ios-dev-handoff-v1.md` 为执行入口；更新 `README.md` 为 iOS 启动阶段说明，补齐 v1~v8 进度与 iOS 开发入口索引。
  - 原因：把“进入 iOS 开发阶段”的执行约束前置到仓库主入口文档，降低后续实现偏差。
  - 影响范围：`AGENTS.md`、`README.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- iOS 开发阶段交接总纲新增：
  - 变更内容：新增 `需求/tsugie-ios-dev-handoff-v1.md`，统一汇总历史需求、语义规范、页面与组件清单、交互状态机、关联逻辑（时间/进度/收藏打卡/日历/主题）及 iOS 实施映射与开发顺序。
  - 原因：结束高频原型迭代后进入正式 iOS 开发，需要单一入口文档降低实现分歧并提升复现效率。
  - 影响范围：`需求/tsugie-ios-dev-handoff-v1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 色彩管理调节与顶栏定位阶段归档（v8）：
  - 变更内容：侧栏配色管理新增“透過比率（透明度比例）”与“彩度”两条滑动条，支持实时调节并本地持久化；主题渲染改为 `--theme-live-*` 动态 token 输出；定位按钮移入顶栏并调整至 `top-kaomoji` 左侧且同高；完成 v8 阶段文档与本地快照归档。
  - 原因：增强配色系统的可控性与可调性，减少固定主题下的视觉僵化；统一顶栏控制节奏并提升操作一致性。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`设计/文档/node-0-1-色彩管理调节与顶栏定位归档-v8.md`、`记录/归档/2026-02-14-node-0-1-色彩管理调节与顶栏定位阶段归档-v8.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-theme-controls-v8/`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 打卡系统与收藏联动阶段归档（v7）：
  - 变更内容：完成地图点位操作气泡（收藏/打卡/进入 quickcard）、地点状态 logo 全链路透出（quickcard/详情/nearby/日历抽屉/收藏抽屉）、左侧收藏抽屉与“全部/未打卡/已打卡”筛选、本地状态持久化；并修正为“侧栏打开默认不选中任何项”“收藏抽屉打开时遮罩覆盖右侧侧栏与主页层（颗粒蒙砂）”“点击遮罩仅关闭收藏抽屉不关闭侧栏”；完成 v7 阶段文档与本地快照归档。
  - 原因：将“想去/去过”语义落地为可执行交互闭环，降低主页面板拥挤与状态分裂，保证后续地点详情与推荐策略可复用同一状态底座。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`设计/文档/node-0-1-打卡系统与收藏联动归档-v7.md`、`记录/归档/2026-02-14-node-0-1-打卡系统与收藏联动阶段归档-v7.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-checkin-favorite-v7/`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 打卡系统与收藏联动（左侧收藏抽屉）：
  - 变更内容：地图点位点击改为先弹出操作气泡，支持收藏/打卡切换并可进入 quickcard；地点状态（收藏/打卡）以 logo 形式接入 quickcard、详情页、附近轮播、日历某日抽屉、收藏抽屉；右侧“行きたい栞”改为触发左侧收藏抽屉，新增“全部/未打卡/已打卡”筛选；收藏与打卡状态本地持久化。
  - 原因：建立“想去/去过”双状态闭环，增强地点决策连续性，并将收藏能力从单栏展示升级为独立抽屉管理。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`AGENTS.md`、`需求/tsugihe_mvp_start_v0.1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 时间呈现一致性与去冗余阶段归档（v6）：
  - 变更内容：quickcard 新增标题行双列布局（地点名在左、活动时间范围在右）；nearby 倒数逻辑切换为详情页同源状态输出（`leftLabel/rightLabel`）；日历某日抽屉新增倒数行并移除开始/结束重复文案，仅保留“时间范围 + 倒数状态”；补齐阶段归档文档与本地前端快照。
  - 原因：统一跨模块时间语义，减少重复信息，提高首屏与时间维度列表的信息效率和可读性。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`设计/文档/node-0-1-时间呈现一致性与去冗余归档-v6.md`、`记录/归档/2026-02-14-node-0-1-时间呈现一致性与去冗余阶段归档-v6.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-time-presentation-v6/`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 进度条强化与一致性修复阶段归档（v5）：
  - 变更内容：完成 `nearbyTrack`、日历某日抽屉列表、收藏列表（进行中）三处进度条接入；将列表进度条定位链路统一为详情页同源 `setProgressPosition`；修复轨道宽度塌陷导致端点固定左侧问题；新增“超过 1 日才开始的 upcoming 不展示进度条”规则；补齐阶段归档文档与本地前端快照。
  - 原因：强化状态感知的一致性与可读性，消除跨场景进度语义漂移和定位异常，确保后续新增列表场景可复用同一机制。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`设计/文档/node-0-1-进度条强化与多场景一致性归档-v5.md`、`记录/归档/2026-02-14-node-0-1-进度条强化与一致性修复阶段归档-v5.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-progress-visibility-v5/`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 日历独立页与高亮规范阶段归档（v4）：
  - 变更内容：完成日历从“叠加面板”到“独立页面切换”的交互模型重构；落地传统月历结构（按月分块、周日开头、7列日格、连续纵向滚动）；将日格内容收敛为分类统计；完成今日高亮主题联动；统一胶囊高亮为“无边框 + 渐变发光 + 朦胧立体感”；增加主题方案本地持久化；新增阶段总结文档、归档索引与本地前端快照。
  - 原因：解决主页与日历状态串扰，明确时间维度页面语义，并建立可复用的高亮视觉基线。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`设计/文档/node-0-1-日历独立页与高亮规范归档-v4.md`、`记录/归档/2026-02-14-node-0-1-日历独立页与高亮规范阶段归档-v4.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-calendar-page-highlight-v4/`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- 配色方案规范升级（胶囊高亮强制规则）：
  - 变更内容：将“胶囊类型高亮”固化为研发规范，统一为 `无边框 + 渐变发光背景 + 朦胧立体感`，且颜色必须跟随当前主题方案；禁止固定色与纯描边高亮。
  - 原因：保证跨页面、跨组件视觉一致性，减少后续实现分歧与返工。
  - 影响范围：`AGENTS.md`、`设计/文档/figma-语义命名与へ抽象规范-v1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 日历页交互模型修正为独立页面切换：
  - 变更内容：将“日历面板叠加主页”的实现调整为“日历独立页面切换”；进入日历时主页组件整体隐藏且不改内部状态，关闭日历后恢复原状态；日历当日列表改为日历专属抽屉（不复用主页侧栏）。
  - 原因：消除日历与主页组件状态串扰（如 quickCard/detail 干扰）并降低交互复杂度。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`需求/tsugihe_mvp_start_v0.1.md`、`设计/文档/node-0-1-时间维度日历语义与交互-v1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 新增时间维度日历（時めぐり）能力：
  - 变更内容：在主页右上角新增 `時めぐり` 入口；新增全屏日历页（时间维度语义）；按天展示最近且最快开始的 2 条 `へ`；每日右上角新增分类统计（含 logo 占位）；点击某一天后从右侧侧栏弹出当天 `へ` 并支持按分类过滤（默认“全部”）；补齐语义与交互说明文档。
  - 原因：补足“地图位置维度”之外的“时间维度”决策入口，降低用户按日期规划时的信息切换成本。
  - 影响范围：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`需求/tsugihe_mvp_start_v0.1.md`、`AGENTS.md`、`设计/文档/node-0-1-时间维度日历语义与交互-v1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
- Node `0:1` 侧栏与配色方案阶段归档（v3）：
  - 变更内容：完成右侧侧栏交互（收藏/通知/联系）、选中态发光强化（选中无边框）、顶部配色胶囊与配色方案块（纯颜色展示）以及多主题一键切换；新增阶段总结文档、归档索引与本地前端快照。
  - 原因：将近期高频 UI 微调固化为可复现资料，确保后续收藏闭环、通知落地与主题 token 化迭代有稳定基线。
  - 影响范围：`设计/文档/node-0-1-侧栏与配色方案归档-v3.md`、`记录/归档/2026-02-14-node-0-1-侧栏与配色方案阶段归档-v3.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-side-drawer-theme-v3/`、`设计/原型/main-screen.html`、`设计/原型/main-screen.css`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。

## 2026-02-13
- 完成根目录重构：`设计/`、`ios开发/`、`数据端/`、`需求/`、`记录/`。
- 迁移历史文件到新结构：
  - `demand/tsugihe_mvp_start_v0.1.md` -> `需求/tsugihe_mvp_start_v0.1.md`
  - `Figma/tsugihe_main_screen_wireframe.svg` -> `设计/figma/tsugihe_main_screen_wireframe.svg`
  - `docs/ui-adjustment-checklist.md` -> `设计/文档/ui-adjustment-checklist.md`
  - `src/ui/main-screen.html` -> `设计/原型/main-screen.html`
  - `src/ui/main-screen.css` -> `设计/原型/main-screen.css`
- `AGENTS.md` 已升级为项目管理基线文档，纳入需求目标、组织方式、工作流程与大变动同步更新机制。
- 新增 Figma 节点 `1:2` 参考文档：`设计/figma/node-1-2-reference.md`（用于后续仅 Figma 侧 UI 调整）。
- 交互规则调整（Node `1:2`）：
  - 变更内容：首屏由“自动弹出推荐卡片”改为“默认全屏地图”；点击标记后弹出“快速查看”卡片。
  - 原因：突出地图优先与决策优先，减少首次进入的信息遮挡与认知负担。
  - 影响范围：`需求/tsugihe_mvp_start_v0.1.md`、`AGENTS.md`、`设计/figma/node-1-2-reference.md`、`设计/文档/node-1-2-figma-adjustment-v2.md`。
  - 执行时间：2026-02-13。
- Figma 自动化链路新增（Codex -> schema -> Plugin）：
  - 变更内容：新增独立子项目 `设计/figma-json-bridge/`，包含 Figma Plugin、schema 规范、示例与校验脚本。
  - 原因：将“Codex 产出 JSON -> Figma 自动落图”流程产品化，减少手工改图成本并提升可重复性。
  - 影响范围：`设计/figma-json-bridge/`、`AGENTS.md`。
  - 执行时间：2026-02-13。
- Figma Plugin 覆盖范围扩展（v1.1）：
  - 变更内容：从“示例节点支持”扩展到“尽量覆盖所有可更新节点/属性”，新增多节点类型、图片填充、实例节点与更多样式属性更新能力。
  - 原因：满足“不是举例，需尽量全覆盖”的执行要求，减少二次手工补改。
  - 影响范围：`设计/figma-json-bridge/plugin/code.js`、`设计/figma-json-bridge/schema/ui-schema.v1.schema.json`、`设计/figma-json-bridge/scripts/validate-ui-schema.js`、`设计/figma-json-bridge/README.md`、`设计/figma-json-bridge/prompts/codex-ui-schema-prompt.md`、`AGENTS.md`。
  - 执行时间：2026-02-13。
- Figma JSON Bridge 正式接入研发流程：
  - 变更内容：新增 `记录/figma-json-bridge研发接入SOP.md`，并在 `AGENTS.md` 增加强制执行条款。
  - 原因：将插件使用从“可选工具”升级为“标准执行路径”，确保改稿可追溯、可复现。
  - 影响范围：`记录/figma-json-bridge研发接入SOP.md`、`AGENTS.md`、`设计/figma-json-bridge/README.md`。
  - 执行时间：2026-02-13。
- Node `1:18` UI 优化与领域抽象升级：
  - 变更内容：新增地图优先 + 延时“最速攻略”方案 schema，建立统一配色系统与「へ」语义命名规范，并将需求文档从“花火活动”抽象为通用「へ」实体。
  - 原因：支持当前花火场景的同时，为后续扩展到其他地点类型预留统一模型和流程。
  - 影响范围：`设计/figma-json-bridge/schema/ui-schema.node-1-18.map-first-fast-guide.v1.json`、`设计/figma-json-bridge/schema/color-system.tsugie-he.v1.json`、`设计/文档/figma-语义命名与へ抽象规范-v1.md`、`设计/文档/node-1-18-ui优化执行单-v1.md`、`设计/figma/node-1-18-reference.md`、`需求/tsugihe_mvp_start_v0.1.md`、`AGENTS.md`、`README.md`、`设计/文档/ui-adjustment-checklist.md`、`设计/figma-json-bridge/README.md`。
  - 执行时间：2026-02-13。
- Figma 插件导入能力增强：
  - 变更内容：`Tsugie UI Schema Bridge` 新增“导入本地 JSON”功能，可直接选择本地 schema 文件加载。
  - 原因：减少手工复制粘贴大 JSON 的出错率，提高应用效率。
  - 影响范围：`设计/figma-json-bridge/plugin/ui.html`、`设计/figma-json-bridge/README.md`。
  - 执行时间：2026-02-13。
- Node `2:29` 地图样式优化与清新主题切换：
  - 变更内容：新增 `node-2-29` 的地图优先 schema，补齐示例地图层、优化点位样式（halo + core + label）、默认切换到清新渐变普通模式，并明确点位展示名使用真实地点名（不使用“xxxへ”）。
  - 原因：解决现有样式过暗、点位不易识别与展示命名不符合语义的体验问题。
  - 影响范围：`设计/figma-json-bridge/schema/ui-schema.node-2-29.map-first-fresh-gradient.v1.json`、`设计/figma-json-bridge/schema/color-system.tsugie-he.v2.fresh.json`、`设计/figma/node-2-29-reference.md`、`设计/文档/node-2-29-ui优化执行单-v1.md`、`设计/文档/figma-语义命名与へ抽象规范-v1.md`、`需求/tsugihe_mvp_start_v0.1.md`、`AGENTS.md`、`README.md`、`设计/figma-json-bridge/README.md`、`设计/figma-json-bridge/prompts/codex-ui-schema-prompt.md`、`设计/文档/ui-adjustment-checklist.md`。
  - 执行时间：2026-02-13。
- Figma 插件新增 color-system 应用模式：
  - 变更内容：`Tsugie UI Schema Bridge` 新增 `校验 color-system` 与 `应用 color-system 到托管节点`，支持在不重建节点的前提下批量刷新托管节点主题色。
  - 原因：解决“导入 color-system 文件时无法直接生效”的使用阻塞，提升主题迭代效率。
  - 影响范围：`设计/figma-json-bridge/plugin/code.js`、`设计/figma-json-bridge/plugin/ui.html`、`设计/figma-json-bridge/README.md`、`AGENTS.md`。
  - 执行时间：2026-02-13。
- Figma 插件新增 color-system 全局应用模式：
  - 变更内容：新增 `全文件应用 color-system`，可遍历当前文件全部页面并更新托管节点主题色。
  - 原因：支持跨页面统一换肤，避免逐页重复操作。
  - 影响范围：`设计/figma-json-bridge/plugin/code.js`、`设计/figma-json-bridge/plugin/ui.html`、`设计/figma-json-bridge/README.md`、`AGENTS.md`。
  - 执行时间：2026-02-13。
- UI 研发流程切换为“HTML 先行 -> Figma 批量落图”：
  - 变更内容：新增 `记录/ui-html-first-figma-batch-sop.md`，明确 UI 需求先在 `设计/原型/` 迭代，待你确认封板后再一次性生成 schema 并落 Figma。
  - 原因：减少反复改稿造成的 Figma 噪音，提升集中落图效率与可追溯性。
  - 影响范围：`记录/ui-html-first-figma-batch-sop.md`、`AGENTS.md`、`设计/figma-json-bridge/README.md`。
  - 执行时间：2026-02-13。
- Node `0:1` 首页原型阶段归档完成：
  - 变更内容：新增前端实现、功能说明、交互说明三份阶段文档，并在 `记录/归档/` 生成阶段归档索引。
  - 原因：固化当前地图优先页面能力，便于后续按同一基线继续迭代与落 Figma。
  - 影响范围：`设计/文档/node-0-1-前端实现归档-v1.md`、`设计/文档/node-0-1-功能文档归档-v1.md`、`设计/文档/node-0-1-交互文档归档-v1.md`、`记录/归档/2026-02-13-node-0-1-页面阶段归档-v1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-13。
- Node `0:1` 前端代码快照归档补充：
  - 变更内容：新增本地前端代码快照目录 `记录/归档/frontend-code-snapshots/2026-02-13-node-0-1-main-screen-v1/`，并将 `记录/归档/frontend-code-snapshots/` 加入 `.gitignore`。
  - 原因：补齐“文档归档 + 代码归档”双轨，且避免快照目录误入版本库。
  - 影响范围：`.gitignore`、`记录/归档/2026-02-13-node-0-1-页面阶段归档-v1.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-13。
- Node `0:1` 详情页与状态演示阶段归档（v2）：
  - 变更内容：完成地图->quickCard->详情页链路、状态进度组件、MVP 多状态演示配置的阶段归档，并新增本地前端代码快照 `记录/归档/frontend-code-snapshots/2026-02-13-node-0-1-detail-progress-v2/`。
  - 原因：将近期高频 UI/交互迭代固化为可追溯基线，支撑后续 Figma 批量同步与验收。
  - 影响范围：`设计/文档/node-0-1-mvp详情页与状态演示归档-v2.md`、`记录/归档/2026-02-13-node-0-1-详情页与状态演示阶段归档-v2.md`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-13。
- Node `0:1` 详情页与状态演示归档升级（v3，可复现资料）：
  - 变更内容：将阶段总结升级为“可复现开发资料”，补齐需求拆解、功能规格、交互状态机、手势阈值、状态计算规则、MVP 演示配置、验收清单与本地复现步骤；新增 v3 归档索引与 v3 本地代码快照。
  - 原因：满足后续复现开发与多轮迭代对“细粒度、可执行文档”的要求。
  - 影响范围：`设计/文档/node-0-1-mvp详情页与状态演示归档-v3.md`、`记录/归档/2026-02-14-node-0-1-详情页与状态演示阶段归档-v3.md`、`记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-mvp-detail-progress-v3/`、`记录/项目变更记录.md`。
  - 执行时间：2026-02-14。
