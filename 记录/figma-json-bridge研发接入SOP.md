# Figma JSON Bridge 研发接入 SOP

## 1. 目的

将 Tsugie 的 Figma 改稿流程标准化为：

`需求变更 -> Codex 产出 ui-schema -> Plugin 应用 -> 设计验收 -> 研发同步`

避免口头改稿和手工重复操作，确保改动可追溯、可复现、可回滚。

## 2. 触发条件

满足任一条件即使用本流程：

- 涉及 2 个以上图层的批量改动
- 同一结构需要在多个状态帧重复调整
- 需要将设计改动沉淀为可复用模板
- 需要把改稿过程交接给其他同学继续执行

## 3. 输入与输出

### 输入
- 当前需求文档（`需求/`）
- Figma fileKey / node-id
- 本次改稿目标（视觉、交互、文案）

### 输出
- 一份可执行 `ui-schema.json`
- Figma 中已应用的节点改动
- 对应记录文档与验收结论

## 4. 标准执行步骤

1. 需求对齐
- 确认改稿目标是否已写入 `需求/` 或 `设计/文档/`

2. 生成 schema
- 使用：`设计/figma-json-bridge/prompts/codex-ui-schema-prompt.md`
- 要求：`id` 全局唯一、节点语义命名清晰

3. 本地校验
- 运行：
  - `node 设计/figma-json-bridge/scripts/validate-ui-schema.js <schema-path>`

4. Figma 应用
- 插件中执行：`校验 -> 应用到 Figma`
- 小改默认不勾选 prune；全量重建才勾选 prune

5. 视觉与交互验收
- 核对布局、颜色、文本层级、交互路径
- 与目标 node 截图进行对照确认

6. 结果归档
- 将 schema 归档到 `设计/figma-json-bridge/schema/`
- 更新相关说明文档（`设计/文档/`）
- 更新 `记录/项目变更记录.md`

## 5. 门禁规则（DoD）

以下条件需全部满足才算完成：

- schema 校验通过
- Figma 插件应用成功且无阻断报错
- 设计验收通过（视觉 + 交互）
- 关键变更已写入记录

## 6. 回滚策略

- 保留上一版 schema 文件（时间戳命名）
- 若改错，重新应用上一版 schema
- 必要时在 Figma 历史版本中回滚

## 7. 责任分工建议

- 产品/设计：定义改稿目标与验收标准
- Codex/研发：产出 schema、执行插件应用、同步文档
- 验收人：确认最终视觉与交互一致性
