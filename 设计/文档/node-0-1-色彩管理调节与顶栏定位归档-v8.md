# Node 0:1 色彩管理调节与顶栏定位归档 v8

## 1. 阶段目标
- 在侧栏配色管理中补齐可调参数能力：支持按比例调节主题透明度与饱和度。
- 保持现有主题体系不被破坏，做到“基于默认主题比例调节”，而不是直接覆写固定透明度。
- 优化顶栏操作一致性：将定位按钮并入顶栏控制组，统一高度与视觉节奏。

## 2. 本阶段需求（最终口径）
1. 侧栏色彩管理新增“透明度比例”滑动条：
- 是比例（ratio）调整，不是直接设置固定 alpha。
- 作用于当前主题默认值，按比例增减。

2. 侧栏色彩管理新增“饱和度”滑动条：
- 用于提升/降低当前主题色彩饱和度。

3. 定位按钮布局优化：
- 定位按钮移到 `top-kaomoji` 左侧。
- 与 `top-kaomoji` 高度一致。

## 3. 功能落地（当前实现）
### 3.1 配色调节 UI
- 在 `themePalettePanel` 内新增 `theme-adjusters` 区块。
- 新增两条 range：
- `透過比率`（70% ~ 130%，默认 100%）
- `彩度`（70% ~ 150%，默认 100%）
- 两条滑动条均带实时百分比数值显示。

### 3.2 调节算法与变量体系
- 新增颜色解析与变换链路：
- `parseColorText`（支持 hex / rgb / rgba）
- `rgbToHsl` / `hslToRgb`
- `adjustColorTone`
- 新增 live token 机制：
- 主题基础 token 仍保留 `--theme-*`。
- 实际渲染切换到 `--theme-live-*`。
- 透明度比例与饱和度变化时，按基础 token 计算 live token，并实时刷新 UI。

### 3.3 持久化
- 新增本地存储键：
- `tsugie.themeAlphaRatio`
- `tsugie.themeSaturationRatio`
- 页面初始化时读取并恢复两组比例。

### 3.4 顶栏定位按钮
- 将 `locateButton` 从独立浮层改为顶栏按钮，位于 `openCalendarButton` 与 `top-kaomoji` 之间。
- 与 `top-kaomoji` 对齐并统一 34px 高度，视觉风格保持同源。

## 4. 设计注意点（后续必须遵守）
1. 比例优先原则：
- 透明度与饱和度都应基于“当前主题默认 token”做比例变换，避免一次调节把主题破坏成不可回溯的固定值。

2. 主题一致性：
- 任何新组件要接入主题系统时，应优先使用 `--theme-live-*` 变量，保证可被滑动条统一调节。

3. 控件语义清晰：
- `透過比率` 表示“透明信息的整体力度比例”。
- `彩度` 表示“颜色鲜艳程度比例”。
- 不直接暴露技术术语（如 alpha/saturation）。

4. 顶栏节奏一致：
- 顶栏按钮高度、圆角、玻璃质感尽量统一。
- 若后续新增顶栏按钮，应先复用当前按钮基线，再做微调。

## 5. 关键实现点
- 配色调节控件：`设计/原型/main-screen.html`
- 比例调节与 token 计算：`设计/原型/main-screen.html`
- live token 变量与样式接入：`设计/原型/main-screen.css`
- 顶栏定位按钮结构位置：`设计/原型/main-screen.html`
- 顶栏定位按钮统一高度样式：`设计/原型/main-screen.css`

## 6. 验收清单
1. 打开配色面板后可看到“透過比率 / 彩度”两条滑动条。
2. 拖动 `透過比率`，界面透明感随比例实时变化。
3. 拖动 `彩度`，界面色彩饱和度随比例实时变化。
4. 切换主题后，滑动条调节仍生效且语义一致。
5. 刷新页面后，透明度比例与饱和度恢复到上次设置。
6. 定位按钮位于 `top-kaomoji` 左侧，且高度一致。

## 7. 关联文件
- `设计/原型/main-screen.html`
- `设计/原型/main-screen.css`
- `记录/项目变更记录.md`
- `记录/归档/2026-02-14-node-0-1-色彩管理调节与顶栏定位阶段归档-v8.md`

## 8. 本地前端快照（不入库）
- `记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-theme-controls-v8/`
