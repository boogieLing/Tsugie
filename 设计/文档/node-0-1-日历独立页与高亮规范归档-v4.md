# Node 0:1 日历独立页与高亮规范归档 v4

## 1. 阶段目标
- 将“时めぐり”日历从主页叠加面板模型，升级为独立页面切换模型。
- 完成传统月历信息结构（按月分块、周日开头、7列日格、连续纵向滚动）。
- 统一胶囊类高亮视觉规则，并落地主题跟随与本地持久化。

## 2. 本阶段需求（最终口径）
1. 日历页语义必须独立于主页语义：
- 地图主页：位置维度决策。
- 日历页：时间维度统计。

2. 日历页信息结构：
- 按月分块。
- 每块内为 7 列日格（周日开始）。
- 日格可显示当天分类统计。
- 点击日格打开“日历专属右侧抽屉”（非主页侧栏）。

3. 切页规则：
- 打开日历时，主页组件整体隐藏。
- 关闭日历时，恢复主页显示。
- 不通过“逐个关闭主页组件”的方式管理状态。

4. 高亮规范：
- 胶囊类高亮统一：无边框 + 渐变发光背景 + 朦胧立体感。
- 高亮颜色必须跟随当前主题方案。
- 主题选择需本地持久化。

## 3. 功能点落地（当前可用）
### 3.1 日历独立页切换
- `openCalendarPanel` 进入 `is-calendar-page` 模式。
- `is-calendar-page` 下隐藏地图主页相关组件：地图、nearby、quickCard、detailPanel、主页侧栏、定位按钮、右上入口。
- 关闭日历后移除 `is-calendar-page`，恢复主页。

### 3.2 传统月历结构
- 月份按连续区间生成并垂直堆叠。
- 默认包含“当前月前 1 个月 + 后 5 个月”（并与活动覆盖月份取并集）。
- 每月包含：
- 月标题
- 周标题（日/月/火/水/木/金/土）
- 日格网格（7列）

### 3.3 日格展示规则
- 非活动日：仅显示日期。
- 活动日：显示分类统计（icon + count），不展示地点名。
- 今日默认高亮，并在打开日历后自动滚动定位到今天。

### 3.4 日历专属抽屉
- 点击活动日打开日历专属右侧抽屉。
- 抽屉内支持分类筛选（默认“全部”）。
- 抽屉内列表按推荐顺序展示（距离优先 + 开始优先 + 热度兜底）。
- 抽屉关闭不影响日历页；日历关闭会同时关闭抽屉。

### 3.5 主题持久化
- 主题存储 key：`tsugie.colorScheme`。
- 页面初始化读取本地主题并应用。
- 用户切换主题时即时写入本地存储。

## 4. 交互与状态注意点
1. 日历是独立页面，不再与主页面板互斥规则耦合。
2. Esc 关闭优先级：
- 日历专属抽屉
- 日历页
- 主页侧栏
- 详情页
- quickCard
3. 日历入口与侧栏入口放入同一容器，避免绝对定位重叠。
4. 侧栏打开时右上入口整体隐藏，避免干扰。

## 5. 设计重点与验收注意点
1. 视觉语义
- 时间维度页（Calendar）与位置维度页（Map）必须可区分，但视觉风格需统一。

2. 高亮语义
- 所有胶囊高亮采用同一机制，禁止“某处发光某处描边”的混用。
- 今日高亮要跟随主题，不可写死某个蓝色/粉色。

3. 信息密度
- 日格信息只保留必要统计，不堆叠地点名，避免日历栅格噪声。

4. 可复现性
- 切页模型优先，避免通过大量“closeXxx/openXxx”处理跨页面状态。

## 6. 关联文件
- `设计/原型/main-screen.html`
- `设计/原型/main-screen.css`
- `设计/原型/local-config.example.js`
- `需求/tsugihe_mvp_start_v0.1.md`
- `设计/文档/figma-语义命名与へ抽象规范-v1.md`

## 7. 本地归档快照
- `记录/归档/frontend-code-snapshots/2026-02-14-node-0-1-calendar-page-highlight-v4/`
