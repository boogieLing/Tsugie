# Node 0:1 前端实现归档 v1

## 1. 归档范围
- 页面：Tsugie 首页地图原型（Map First）
- 版本：HTML 先行迭代阶段 v1
- 时间：2026-02-13
- 代码基线：`设计/原型/main-screen.html`、`设计/原型/main-screen.css`

## 2. 前端文件与职责
- `设计/原型/main-screen.html`
- 职责：页面结构、交互状态、地图模式切换、点位与卡片逻辑、轮播逻辑、当前位置逻辑。
- `设计/原型/main-screen.css`
- 职责：视觉主题、地图层样式、点位样式、底部面板样式、动画与响应式样式。

## 3. 页面结构（DOM）
- 右上角入口：`top-kaomoji`（随机颜文字按钮，预留菜单入口）。
- 右侧定位按钮：`locate-button`（返回当前位置）。
- 地图区：`googleMap` + `map-tint` + `fallbackLayer` + `mapHint`。
- 底部互斥区 A：`nearbyCarousel`（横向可滑动卡片流）。
- 底部互斥区 B：`quickCard`（最速攻略，快速查看）。

## 4. 运行模式
- 模式 A：Google Maps JavaScript API 可用。
- 行为：渲染交互地图与原生 marker，支持拖拽缩放与点位点击。
- 模式 B：JS API 不可用，降级为 Embed + 覆盖层。
- 行为：地图改为 Embed 或示例背景，点位使用覆盖层渲染，仍可点击。

## 5. 状态模型
- 地图状态：`mapInstance`。
- 点位激活状态：`currentFocusPlaceId`。
- 自动弹卡定时器：`autoOpenTimer`、`autoOpenScheduled`。
- 当前位置状态：`currentLocationPosition`。
- 当前位置 marker 句柄：`currentLocationMarker`、`currentLocationPulseTimer`。

## 6. 关键实现点
- 点位渲染：每个地点采用渐变色对（`colorPairs`）生成视觉区分。
- 选中态：点位放大、发光、呼吸动画。
- 快速查看卡片：仅做“快速了解”，非详情页。
- 底部轮播：依据当前可见范围外扩区域筛选候选点，显示“近一点点但不在当前画面内”的地点。
- 互斥机制：`quickCard` 显示时隐藏轮播；`quickCard` 关闭时显示轮播。

## 7. 当前位置实现（测试阶段）
- 当前阶段为测试模式，定位坐标固定：`35.710063, 139.8107`（隅田川 / 天空树附近）。
- 首次加载时，定位点会被放到屏幕中央偏下位置。
- 点击右侧定位按钮，地图快速回到该定位点。

## 8. 当前轮播信息结构
- 第一行：地点名（左）+ 距离（右）。
- 第二行：剩余时间（左）+ 开始时间（右）。
- 文案语言：日文。

## 9. 样式策略
- 清新薄荷蓝绿主色方向。
- 地图全屏优先，底部面板玻璃感但不过度厚重。
- 轮播容器本体无背景、无边框，仅卡片本体承载信息。

## 10. 已知限制
- 当前定位为固定测试坐标，尚未启用真实设备定位。
- 当前位置在降级模式下为覆盖层样式点，不参与地图底图真实投影。
