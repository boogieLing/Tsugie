# Tsugi e 项目管理与协作规范

## 1. 项目开发目标（以 `需求/tsugihe_mvp_start_v0.1.md` 为准）

> 进入正式 iOS 开发阶段后，执行基线同时以 `需求/tsugie-ios-dev-handoff-v1.md` 为准。

### 1.1 产品定位
- 产品：つぎへ（Tsugi e）
- 目标：在当前时间与地点下，给用户一个“下一站值得去的へ”决策
- 原则：打开即用、无需登录、地图优先、决策优先、表达克制

### 1.2 MVP 目标
- 用最小可用功能验证核心价值
- 快速上线并收集真实反馈
- 严格控制范围，不追求复杂和完整

### 1.3 MVP 核心范围
- 首页地图：定位、附近「へ」标记、首屏全屏地图（默认不弹卡片）
- 今日推荐：今日优先、距离优先、规模优先，仅输出一个最速攻略へ
- 地图交互：标记点击“快速查看”半屏卡片、上滑进入详情
- 自动触发：进入一定时间后自动弹出“最速攻略”卡片
- 详情页：活动关键信息与导航入口
- 时间维度日历：右上角入口进入全屏“時めぐり”，按日展示最近且最快开始的 2 条并支持按天侧栏分类浏览
- 收藏与打卡联动：地图点位气泡可执行收藏/打卡，地点卡片统一输出状态 logo，收藏入口改为“右侧菜单 + 左侧收藏抽屉（含已打卡/未打卡筛选）”
- 时间筛选：Today / This Week
- 本地通知：开始前提醒（无需登录）

### 1.4 MVP 明确不做
- 账号/登录、社交/评论、复杂算法、摄影增强、路径优化、支付订阅、多语言

## 2. 项目目录组织方式（强制）

根目录固定按以下 5 个模块组织：

- `设计/`：产品与交互设计资产
- `ios开发/`：iOS 客户端代码（Swift/SwiftUI）与测试
- `数据端/`：数据处理、接口、推荐排序相关实现
- `需求/`：需求文档、版本需求说明
- `记录/`：过程记录、决策记录、变更记录，历史材料放 `记录/归档/`

当前建议子结构：

- `设计/figma/`：Figma 导出或链接说明
- `设计/原型/`：原型代码（HTML/CSS/交互稿）
- `设计/文档/`：设计检查清单、设计说明
- `记录/归档/`：已结项或废弃方案归档

新增文件时必须归档到以上模块，不再使用 `src/`、`docs/`、`demand/` 这类旧结构。

## 3. 工作流程（需求 -> 设计 -> 开发 -> 记录）

1. 需求阶段：
- 先更新 `需求/` 中对应版本文档，再开始实现。

2. 设计阶段：
- 设计稿、线框图、交互说明统一进入 `设计/`。
- 影响开发的设计结论必须可追溯。

3. 开发阶段：
- iOS 代码只放 `ios开发/`。
- 数据相关实现只放 `数据端/`。
- 接口/字段/排序规则变更必须同步更新需求或记录。
- 正式 iOS 开发前，必须先对齐 `需求/tsugie-ios-dev-handoff-v1.md` 的页面语义、组件语义、交互状态机与关联逻辑。

4. 联调与验收阶段：
- 以 MVP 范围为边界，不扩功能。
- 验收以“可用且可验证”优先。

5. 记录与归档阶段：
- 关键决策、里程碑、风险与结论写入 `记录/`。
- 完成阶段性任务后，将历史材料移入 `记录/归档/`。

## 4. 大变动同步更新机制（必须执行）

出现以下任一情况，必须在同一次工作中同步更新 `AGENTS.md` 与 `记录/项目变更记录.md`：

- MVP 范围变更（新增/删除功能）
- 目录结构调整
- 推荐逻辑或关键业务规则变化
- 技术栈或端到端流程变化
- 里程碑计划变化（如 8 周节奏调整）

更新要求：
- 写清“变更内容、原因、影响范围、执行时间”。
- 若变更影响需求，必须同步更新 `需求/` 下对应文档版本。

## 5. 协作与命名规范

- 根目录使用上述固定中文模块名。
- 模块内新增目录建议使用 `kebab-case`。
- 测试文件与实现文件保持一一映射。
- 提交信息建议使用 Conventional Commits（如 `feat:`、`fix:`、`docs:`）。

## 6. 当前里程碑基线（8 周）

- Week 1: 初始化、定位与地图基础
- Week 2: 地图标记与 Mock 数据
- Week 3: 推荐排序与推荐卡片
- Week 4: 详情页与导航跳转
- Week 5: 时间筛选与本地通知
- Week 6: Bug 修复与性能优化
- Week 7: TestFlight 内测
- Week 8: 上架准备与提审

## 7. Figma 自动化基线（新增）

- 新增独立项目：`设计/figma-json-bridge/`
- 目标流程：`Codex -> ui-schema.json -> Figma Plugin -> 自动创建/更新节点`
- 适用范围：Figma 侧结构化批量改稿，不直接替代产品需求评审与交互验收
- 产物要求：
  - schema 版本化（当前 `version: 1.0`）
  - 节点 `id` 全局唯一，支持幂等更新
  - 大改稿优先使用 `校验 -> 应用` 两步流程
  - 节点覆盖按“能更新尽量更新”原则扩展（不限于 Frame/AutoLayout/Text/Button）

## 8. Figma JSON Bridge 研发流程（强制）

- 研发流程文档：`记录/figma-json-bridge研发接入SOP.md`
- UI 研发节奏文档：`记录/ui-html-first-figma-batch-sop.md`
- 适用范围：涉及 Figma 结构化改稿的需求与交互调整
- 执行要求：
  - 默认先在 `设计/原型/` 完成 HTML 迭代，封板后再一次性落 Figma
  - 先明确需求目标，再生成 schema
  - schema 先本地校验，再插件应用
  - 支持 `color-system` 模式：可对当前页面或当前文件全部页面的托管节点执行批量主题上色
  - 小改默认不启用 prune；全量重建可启用 prune
  - 完成后必须更新 `记录/项目变更记录.md`
- 交付门禁：
  - schema 校验通过
  - 插件应用成功
  - 视觉与交互验收通过

## 9. へ抽象与设计资产治理（强制）

- `へ` 为统一业务实体，花火大会仅是首个垂类，不得在通用组件命名中硬编码。
- 普通模式颜色管理统一使用：`设计/figma-json-bridge/schema/color-system.tsugie-he.v2.fresh.json`
- 元素/组件语义命名统一使用：`设计/文档/figma-语义命名与へ抽象规范-v1.md`
- UI 展示名称使用地点真实名称，不使用“xxxへ”后缀（`へ` 仅作为语义层概念）。
- 胶囊类高亮（chip/pill/tag/segmented-active）统一强制规则：`无边框 + 渐变发光背景 + 朦胧立体感`，发光颜色必须跟随当前配色方案，不允许使用固定色或纯描边高亮。
- 收藏语义固定为“想要访问”，打卡语义固定为“已经访问”；所有地点卡片中的两种状态统一使用 logo，不使用状态文字。
- Node `1:18` 优化执行参考：`设计/文档/node-1-18-ui优化执行单-v1.md`
- Node `2:29` 优化执行参考：`设计/文档/node-2-29-ui优化执行单-v1.md`

## 10. iOS 开发阶段基线（强制）

- iOS 研发统一入口文档：`需求/tsugie-ios-dev-handoff-v1.md`
- iOS 阶段必须遵循以下强约束：
  - 地图页与日历页语义独立：地图是位置维度，日历是时间维度。
  - 时间状态计算同源：所有卡片/列表场景统一使用同一状态模型（`upcoming / ongoing / ended / unknown`）。
  - 进度条语义同源：详情、quick、nearby、日历抽屉、收藏抽屉保持一致规则。
  - 收藏/打卡语义固定：收藏=想访问，打卡=已访问，统一 logo 表达，不用状态文字。
  - 胶囊高亮统一：无边框 + 渐变发光 + 朦胧立体感，并跟随当前主题。
  - MVP 不扩边界：不引入账号/社交/支付/复杂算法等非 MVP 能力。
- iOS 开发交付顺序建议（默认）：
  1. 地图主页骨架（点位 + quickCard 基础链路）
  2. 详情页与手势闭环
  3. 日历独立页与日历日抽屉
  4. 收藏/打卡联动与收藏抽屉
  5. 主题调节、本地通知与稳定性回归
